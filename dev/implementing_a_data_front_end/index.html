<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implementing a data front end · MLJModelInterface</title><meta name="title" content="Implementing a data front end · MLJModelInterface"/><meta property="og:title" content="Implementing a data front end · MLJModelInterface"/><meta property="twitter:title" content="Implementing a data front end · MLJModelInterface"/><meta name="description" content="Documentation for MLJModelInterface."/><meta property="og:description" content="Documentation for MLJModelInterface."/><meta property="twitter:description" content="Documentation for MLJModelInterface."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MLJModelInterface</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quick_start_guide/">Quick-start guide</a></li><li><a class="tocitem" href="../the_model_type_hierarchy/">The model type hierarchy</a></li><li><a class="tocitem" href="../type_declarations/">New model type declarations</a></li><li><a class="tocitem" href="../supervised_models/">Supervised models</a></li><li><a class="tocitem" href="../summary_of_methods/">Summary of methods</a></li><li><a class="tocitem" href="../form_of_data/">The form of data for fitting and predicting</a></li><li><a class="tocitem" href="../the_fit_method/">The fit method</a></li><li><a class="tocitem" href="../the_fitted_params_method/">The fitted_params method</a></li><li><a class="tocitem" href="../the_predict_method/">The predict method</a></li><li><a class="tocitem" href="../the_predict_joint_method/">The predict_joint method</a></li><li><a class="tocitem" href="../training_losses/">Training losses</a></li><li><a class="tocitem" href="../feature_importances/">Feature importances</a></li><li><a class="tocitem" href="../trait_declarations/">Trait declarations</a></li><li><a class="tocitem" href="../iterative_models/">Iterative models and the update! method</a></li><li class="is-active"><a class="tocitem" href>Implementing a data front end</a><ul class="internal"><li><a class="tocitem" href="#Sample-implementation"><span>Sample implementation</span></a></li></ul></li><li><a class="tocitem" href="../supervised_models_with_transform/">Supervised models with a transform method</a></li><li><a class="tocitem" href="../fitting_distributions/">Models that learn a probability distribution</a></li><li><a class="tocitem" href="../serialization/">Serialization</a></li><li><a class="tocitem" href="../document_strings/">Document strings</a></li><li><a class="tocitem" href="../unsupervised_models/">Unsupervised models</a></li><li><a class="tocitem" href="../static_models/">Static models</a></li><li><a class="tocitem" href="../outlier_detection_models/">Outlier detection models</a></li><li><a class="tocitem" href="../convenience_methods/">Convenience methods</a></li><li><a class="tocitem" href="../where_to_put_code/">Where to place code implementing new models</a></li><li><a class="tocitem" href="../how_to_register/">How to add models to the MLJ Model Registry</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Implementing a data front end</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implementing a data front end</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaAI/MLJModelInterface.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaAI/MLJModelInterface.jl/blob/dev/docs/src/implementing_a_data_front_end.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Implementing-a-data-front-end"><a class="docs-heading-anchor" href="#Implementing-a-data-front-end">Implementing a data front-end</a><a id="Implementing-a-data-front-end-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-a-data-front-end" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>It is suggested that packages implementing MLJ&#39;s model API, that later implement a data front-end, should tag their changes in a breaking release. (The changes will not break the use of models for the ordinary MLJ user, who interacts with models exclusively through the machine interface. However, it will break usage for some external packages that have chosen to depend directly on the model API.)</p></div></div><pre><code class="language-julia hljs">MLJModelInterface.reformat(model, args...) -&gt; data
MLJModelInterface.selectrows(::Model, I, data...) -&gt; sampled_data</code></pre><p>Models optionally overload <code>reformat</code> to define transformations of user-supplied data into some model-specific representation (e.g., from a table to a matrix). Computational overheads associated with multiple <code>fit!</code>/<code>predict</code>/<code>transform</code> calls (on MLJ machines) are then avoided when memory resources allow. The fallback returns <code>args</code> (no transformation).</p><p>The <code>selectrows(::Model, I, data...)</code> method is overloaded to specify how the model-specific data is to be subsampled, for some observation indices <code>I</code> (a colon, <code>:</code>, or instance of <code>AbstractVector{&lt;:Integer}</code>). In this way, implementing a data front-end also allows more efficient resampling of data (in user calls to <code>evaluate!</code>).</p><p>After detailing formal requirements for implementing a data front-end, we give a <a href="#Sample-implementation">Sample implementation</a>. A simple <a href="https://github.com/Evovest/EvoTrees.jl/blob/94b58faf3042009bd609c9a5155a2e95486c2f0e/src/MLJ.jl#L23">implementation</a> also appears in the EvoTrees.jl package.</p><p>Here &quot;user-supplied data&quot; is what the MLJ user supplies when constructing a machine, as in <code>machine(models, args...)</code>, which coincides with the arguments expected by <code>fit(model, verbosity, args...)</code> when <code>reformat</code> is not overloaded.</p><p>Overloading <code>reformat</code> is permitted for any <code>Model</code> subtype, except for subtypes of <code>Static</code>. Here is a complete list of responsibilities for such an implementation, for some <code>model::SomeModelType</code> (a sample implementation follows after):</p><ul><li><p>A <code>reformat(model::SomeModelType, args...) -&gt; data</code> method must be implemented for each form of <code>args...</code> appearing in a valid machine construction <code>machine(model, args...)</code> (there will be one for each possible signature of <code>fit(::SomeModelType, ...)</code>).</p></li><li><p>Additionally, if not included above, there must be a single argument form of reformat, <code>reformat(model::SomeModelType, arg) -&gt; (data,)</code>, serving as a data front-end for operations like <code>predict</code>. It must always hold that <code>reformat(model, args...)[1] = reformat(model, args[1])</code>.</p></li></ul><p>The fallback is <code>reformat(model, args...) = args</code> (i.e., slurps provided data).</p><p><em>Important.</em> <code>reformat(model::SomeModelType, args...)</code> must always return a tuple, even if   this has length one. The length of the tuple need not match <code>length(args)</code>.</p><ul><li><p><code>fit(model::SomeModelType, verbosity, data...)</code> should be implemented as if <code>data</code> is the output of <code>reformat(model, args...)</code>, where <code>args</code> is the data an MLJ user has bound to <code>model</code> in some machine. The same applies to any overloading of <code>update</code>.</p></li><li><p>Each implemented operation, such as <code>predict</code> and <code>transform</code> - but excluding <code>inverse_transform</code> - must be defined as if its data arguments are <code>reformat</code>ed versions of user-supplied data. For example, in the supervised case, <code>data_new</code> in <code>predict(model::SomeModelType, fitresult, data_new)</code> is <code>reformat(model, Xnew)</code>, where <code>Xnew</code> is the data provided by the MLJ user in a call <code>predict(mach, Xnew)</code> (<code>mach.model == model</code>).</p></li><li><p>To specify how the model-specific representation of data is to be resampled, implement <code>selectrows(model::SomeModelType, I, data...) -&gt; resampled_data</code> for each overloading of <code>reformat(model::SomeModel, args...) -&gt; data</code> above. Here <code>I</code> is an arbitrary abstract integer vector or <code>:</code> (type <code>Colon</code>).</p></li></ul><p><em>Important.</em> <code>selectrows(model::SomeModelType, I, args...)</code> must always return a tuple of the same length as <code>args</code>, even if this is one.</p><p>The fallback for <code>selectrows</code> is described at <a href="../reference/#MLJModelInterface.selectrows"><code>selectrows</code></a>.</p><h2 id="Sample-implementation"><a class="docs-heading-anchor" href="#Sample-implementation">Sample implementation</a><a id="Sample-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Sample-implementation" title="Permalink"></a></h2><p>Suppose a supervised model type <code>SomeSupervised</code> supports sample weights, leading to two different <code>fit</code> signatures, and that it has a single operation <code>predict</code>:</p><pre><code class="nohighlight hljs">fit(model::SomeSupervised, verbosity, X, y)
fit(model::SomeSupervised, verbosity, X, y, w)

predict(model::SomeSupervised, fitresult, Xnew)</code></pre><p>Without a data front-end implemented, suppose <code>X</code> is expected to be a table and <code>y</code> a vector, but suppose the core algorithm always converts <code>X</code> to a matrix with features as rows (each record corresponds to a column in the table).  Then a new data-front end might look like this:</p><pre><code class="nohighlight hljs">constant MMI = MLJModelInterface

# for fit:
MMI.reformat(::SomeSupervised, X, y) = (MMI.matrix(X)&#39;, y)
MMI.reformat(::SomeSupervised, X, y, w) = (MMI.matrix(X)&#39;, y, w)
MMI.selectrows(::SomeSupervised, I, Xmatrix, y) =
	(view(Xmatrix, :, I), view(y, I))
MMI.selectrows(::SomeSupervised, I, Xmatrix, y, w) =
	(view(Xmatrix, :, I), view(y, I), view(w, I))

# for predict:
MMI.reformat(::SomeSupervised, X) = (MMI.matrix(X)&#39;,)
MMI.selectrows(::SomeSupervised, I, Xmatrix) = (view(Xmatrix, :, I),)</code></pre><p>With these additions, <code>fit</code> and <code>predict</code> are refactored, so that <code>X</code> and <code>Xnew</code> represent matrices with features as rows.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../iterative_models/">« Iterative models and the update! method</a><a class="docs-footer-nextpage" href="../supervised_models_with_transform/">Supervised models with a transform method »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Friday 22 March 2024 21:03">Friday 22 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
