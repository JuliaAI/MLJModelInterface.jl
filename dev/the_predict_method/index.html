<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The predict method · MLJModelInterface</title><meta name="title" content="The predict method · MLJModelInterface"/><meta property="og:title" content="The predict method · MLJModelInterface"/><meta property="twitter:title" content="The predict method · MLJModelInterface"/><meta name="description" content="Documentation for MLJModelInterface."/><meta property="og:description" content="Documentation for MLJModelInterface."/><meta property="twitter:description" content="Documentation for MLJModelInterface."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MLJModelInterface</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quick_start_guide/">Quick-start guide</a></li><li><a class="tocitem" href="../the_model_type_hierarchy/">The model type hierarchy</a></li><li><a class="tocitem" href="../type_declarations/">New model type declarations</a></li><li><a class="tocitem" href="../supervised_models/">Supervised models</a></li><li><a class="tocitem" href="../summary_of_methods/">Summary of methods</a></li><li><a class="tocitem" href="../form_of_data/">The form of data for fitting and predicting</a></li><li><a class="tocitem" href="../the_fit_method/">The fit method</a></li><li><a class="tocitem" href="../the_fitted_params_method/">The fitted_params method</a></li><li class="is-active"><a class="tocitem" href>The predict method</a><ul class="internal"><li><a class="tocitem" href="#Prediction-types-for-deterministic-responses."><span>Prediction types for deterministic responses.</span></a></li><li><a class="tocitem" href="#Prediction-types-for-probabilistic-responses"><span>Prediction types for probabilistic responses</span></a></li><li><a class="tocitem" href="#Report-items-returned-by-predict"><span>Report items returned by predict</span></a></li></ul></li><li><a class="tocitem" href="../the_predict_joint_method/">The predict_joint method</a></li><li><a class="tocitem" href="../training_losses/">Training losses</a></li><li><a class="tocitem" href="../feature_importances/">Feature importances</a></li><li><a class="tocitem" href="../trait_declarations/">Trait declarations</a></li><li><a class="tocitem" href="../iterative_models/">Iterative models and the update! method</a></li><li><a class="tocitem" href="../implementing_a_data_front_end/">Implementing a data front end</a></li><li><a class="tocitem" href="../supervised_models_with_transform/">Supervised models with a transform method</a></li><li><a class="tocitem" href="../fitting_distributions/">Models that learn a probability distribution</a></li><li><a class="tocitem" href="../serialization/">Serialization</a></li><li><a class="tocitem" href="../document_strings/">Document strings</a></li><li><a class="tocitem" href="../unsupervised_models/">Unsupervised models</a></li><li><a class="tocitem" href="../static_models/">Static models</a></li><li><a class="tocitem" href="../outlier_detection_models/">Outlier detection models</a></li><li><a class="tocitem" href="../convenience_methods/">Convenience methods</a></li><li><a class="tocitem" href="../where_to_put_code/">Where to place code implementing new models</a></li><li><a class="tocitem" href="../how_to_register/">How to add models to the MLJ Model Registry</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>The predict method</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The predict method</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaAI/MLJModelInterface.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaAI/MLJModelInterface.jl/blob/dev/docs/src/the_predict_method.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-predict-method"><a class="docs-heading-anchor" href="#The-predict-method">The predict method</a><a id="The-predict-method-1"></a><a class="docs-heading-anchor-permalink" href="#The-predict-method" title="Permalink"></a></h1><p>A compulsory <code>predict</code> method has the form</p><pre><code class="language-julia hljs">MMI.predict(model::SomeSupervisedModel, fitresult, Xnew) -&gt; yhat</code></pre><p>Here <code>Xnew</code> will have the same form as the <code>X</code> passed to <code>fit</code>.</p><p>Note that while <code>Xnew</code> generally consists of multiple observations (e.g., has multiple rows in the case of a table) it is assumed, in view of the i.i.d assumption recalled above, that calling <code>predict(..., Xnew)</code> is equivalent to broadcasting some method <code>predict_one(..., x)</code> over the individual observations <code>x</code> in <code>Xnew</code> (a method implementing the probability distribution <code>p(X |y)</code> above).</p><h2 id="Prediction-types-for-deterministic-responses."><a class="docs-heading-anchor" href="#Prediction-types-for-deterministic-responses.">Prediction types for deterministic responses.</a><a id="Prediction-types-for-deterministic-responses.-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction-types-for-deterministic-responses." title="Permalink"></a></h2><p>In the case of <code>Deterministic</code> models, <code>yhat</code> should have the same scitype as the <code>y</code> passed to <code>fit</code> (see above). If <code>y</code> is a <code>CategoricalVector</code> (classification) then elements of the prediction <code>yhat</code> <strong>must have a pool == to the pool of the target <code>y</code> presented in training</strong>, even if not all levels appear in the training data or prediction itself.</p><p>Unfortunately, code not written with the preservation of categorical levels in mind poses special problems. To help with this, MLJModelInterface provides some utilities: <a href="../convenience_methods/#MLJModelInterface.int-convenience_methods"><code>MLJModelInterface.int</code></a> (for converting a <code>CategoricalValue</code> into an integer, the ordering of these integers being consistent with that of the pool) and <code>MLJModelInterface.decoder</code> (for constructing a callable object that decodes the integers back into <code>CategoricalValue</code> objects). Refer to <a href="../convenience_methods/#Convenience-methods">Convenience methods</a> below for important details.</p><p>Note that a decoder created during <code>fit</code> may need to be bundled with <code>fitresult</code> to make it available to <code>predict</code> during re-encoding. So, for example, if the core algorithm being wrapped by <code>fit</code> expects a nominal target <code>yint</code> of type <code>Vector{&lt;:Integer}</code> then a <code>fit</code> method may look something like this:</p><pre><code class="language-julia hljs">function MMI.fit(model::SomeSupervisedModel, verbosity, X, y)
    yint = MMI.int(y)
    a_target_element = y[1]                # a CategoricalValue/String
    decode = MMI.decoder(a_target_element) # can be called on integers

    core_fitresult = SomePackage.fit(X, yint, verbosity=verbosity)

    fitresult = (decode, core_fitresult)
    cache = nothing
    report = nothing
    return fitresult, cache, report
end</code></pre><p>while a corresponding deterministic <code>predict</code> operation might look like this:</p><pre><code class="language-julia hljs">function MMI.predict(model::SomeSupervisedModel, fitresult, Xnew)
    decode, core_fitresult = fitresult
    yhat = SomePackage.predict(core_fitresult, Xnew)
    return decode.(yhat)
end</code></pre><p>For a concrete example, refer to the <a href="https://github.com/JuliaAI/MLJModels.jl/blob/master/src/ScikitLearn.jl">code</a> for <code>SVMClassifier</code>.</p><p>Of course, if you are coding a learning algorithm from scratch, rather than wrapping an existing one, these extra measures may be unnecessary.</p><h2 id="Prediction-types-for-probabilistic-responses"><a class="docs-heading-anchor" href="#Prediction-types-for-probabilistic-responses">Prediction types for probabilistic responses</a><a id="Prediction-types-for-probabilistic-responses-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction-types-for-probabilistic-responses" title="Permalink"></a></h2><p>In the case of <code>Probabilistic</code> models with univariate targets, <code>yhat</code> must be an <code>AbstractVector</code> or table whose elements are distributions. In the common case of a vector (single target), this means one distribution per row of <code>Xnew</code>.</p><p>A <em>distribution</em> is some object that, at the least, implements <code>Base.rng</code> (i.e., is something that can be sampled).  Currently, all performance measures (metrics) defined in MLJBase.jl additionally assume that a distribution is either:</p><ul><li><p>An instance of some subtype of <code>Distributions.Distribution</code>, an abstract type defined in the <a href="https://juliastats.org/Distributions.jl/stable/"><code>Distributions.jl</code></a> package; or</p></li><li><p>An instance of <code>CategoricalDistributions.UnivariateFinite</code>, from the <a href="https://github.com/JuliaAI/CategoricalDistributions.jl">CategoricalDistributions.jl</a> package, <em>which should be used for all probabilistic classifiers</em>, i.e., for predictors whose target has scientific type <code>&lt;:AbstractVector{&lt;:Finite}</code>.</p></li></ul><p>All such distributions implement the probability mass or density function <code>Distributions.pdf</code>. If your model&#39;s predictions cannot be predict objects of this form, then you will need to implement appropriate performance measures to buy into MLJ&#39;s performance evaluation apparatus.</p><p>An implementation can avoid CategoricalDistributions.jl as a dependency by using the &quot;dummy&quot; constructor <code>MLJModelInterface.UnivariateFinite</code>, which is bound to the true one when MLJBase.jl is loaded.</p><p>For efficiency, one should not construct <code>UnivariateFinite</code> instances one at a time. Rather, once a probability vector, matrix, or dictionary is known, construct an instance of <code>UnivariateFiniteVector &lt;: AbstractArray{&lt;:UnivariateFinite},1}</code> to return. Both <code>UnivariateFinite</code> and <code>UnivariateFiniteVector</code> objects are constructed using the single <code>UnivariateFinite</code> function.</p><p>For example, suppose the target <code>y</code> arrives as a subsample of some <code>ybig</code> and is missing some classes:</p><pre><code class="language-julia hljs">ybig = categorical([:a, :b, :a, :a, :b, :a, :rare, :a, :b])
y = ybig[1:6]</code></pre><p>Your fit method has bundled the first element of <code>y</code> with the <code>fitresult</code> to make it available to <code>predict</code> for purposes of tracking the complete pool of classes. Let&#39;s call this <code>an_element = y[1]</code>. Then, supposing the corresponding probabilities of the observed classes <code>[:a, :b]</code> are in an <code>n x 2</code> matrix <code>probs</code> (where <code>n</code> the number of rows of <code>Xnew</code>) then you return</p><pre><code class="language-julia hljs">yhat = MLJModelInterface.UnivariateFinite([:a, :b], probs, pool=an_element)</code></pre><p>This object automatically assigns zero-probability to the unseen class <code>:rare</code> (i.e., <code>pdf.(yhat, :rare)</code> works and returns a zero vector). If you would like to assign <code>:rare</code> non-zero probabilities, simply add it to the first vector (the <em>support</em>) and supply a larger <code>probs</code> matrix.</p><p>In a binary classification problem, it suffices to specify a single vector of probabilities, provided you specify <code>augment=true</code>, as in the following example, <em>and note carefully that these probabilities are associated with the</em> <strong>last</strong> <em>(second) class you specify in the constructor:</em></p><pre><code class="language-julia hljs">y = categorical([:TRUE, :FALSE, :FALSE, :TRUE, :TRUE])
an_element = y[1]
probs = rand(10)
yhat = MLJModelInterface.UnivariateFinite([:FALSE, :TRUE], probs, augment=true, pool=an_element)</code></pre><p>The constructor has a lot of options, including passing a dictionary instead of vectors. See <a href="@ref"><code>CategoricalDistributions.UnivariateFinite</code></a> for details.</p><p>See <a href="https://github.com/JuliaAI/MLJModels.jl/blob/master/src/GLM.jl">LinearBinaryClassifier</a> for an example of a Probabilistic classifier implementation.</p><p><em>Important note on binary classifiers.</em> There is no &quot;Binary&quot; scitype distinct from <code>Multiclass{2}</code> or <code>OrderedFactor{2}</code>; <code>Binary</code> is just an alias for <code>Union{Multiclass{2},OrderedFactor{2}}</code>. The <code>target_scitype</code> of a binary classifier will generally be <code>AbstractVector{&lt;:Binary}</code> and according to the <em>mlj</em> scitype convention, elements of <code>y</code> have type <code>CategoricalValue</code>, and <em>not</em> <code>Bool</code>. See <a href="https://github.com/JuliaAI/MLJModels.jl/blob/master/src/GLM.jl">BinaryClassifier</a> for an example.</p><h2 id="Report-items-returned-by-predict"><a class="docs-heading-anchor" href="#Report-items-returned-by-predict">Report items returned by predict</a><a id="Report-items-returned-by-predict-1"></a><a class="docs-heading-anchor-permalink" href="#Report-items-returned-by-predict" title="Permalink"></a></h2><p>A <code>predict</code> method, or other operation such as <code>transform</code>, can contribute to the report accessible in any machine associated with a model. See <a href="../static_models/#Reporting-byproducts-of-a-static-transformation">Reporting byproducts of a static transformation</a> below for details.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../the_fitted_params_method/">« The fitted_params method</a><a class="docs-footer-nextpage" href="../the_predict_joint_method/">The predict_joint method »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 2 July 2024 23:24">Tuesday 2 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
