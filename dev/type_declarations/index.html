<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>New model type declarations · MLJModelInterface</title><meta name="title" content="New model type declarations · MLJModelInterface"/><meta property="og:title" content="New model type declarations · MLJModelInterface"/><meta property="twitter:title" content="New model type declarations · MLJModelInterface"/><meta name="description" content="Documentation for MLJModelInterface."/><meta property="og:description" content="Documentation for MLJModelInterface."/><meta property="twitter:description" content="Documentation for MLJModelInterface."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MLJModelInterface</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quick_start_guide/">Quick-start guide</a></li><li><a class="tocitem" href="../the_model_type_hierarchy/">The model type hierarchy</a></li><li class="is-active"><a class="tocitem" href>New model type declarations</a></li><li><a class="tocitem" href="../supervised_models/">Supervised models</a></li><li><a class="tocitem" href="../summary_of_methods/">Summary of methods</a></li><li><a class="tocitem" href="../form_of_data/">The form of data for fitting and predicting</a></li><li><a class="tocitem" href="../the_fit_method/">The fit method</a></li><li><a class="tocitem" href="../the_fitted_params_method/">The fitted_params method</a></li><li><a class="tocitem" href="../the_predict_method/">The predict method</a></li><li><a class="tocitem" href="../the_predict_joint_method/">The predict_joint method</a></li><li><a class="tocitem" href="../training_losses/">Training losses</a></li><li><a class="tocitem" href="../feature_importances/">Feature importances</a></li><li><a class="tocitem" href="../trait_declarations/">Trait declarations</a></li><li><a class="tocitem" href="../iterative_models/">Iterative models and the update! method</a></li><li><a class="tocitem" href="../implementing_a_data_front_end/">Implementing a data front end</a></li><li><a class="tocitem" href="../supervised_models_with_transform/">Supervised models with a transform method</a></li><li><a class="tocitem" href="../fitting_distributions/">Models that learn a probability distribution</a></li><li><a class="tocitem" href="../serialization/">Serialization</a></li><li><a class="tocitem" href="../document_strings/">Document strings</a></li><li><a class="tocitem" href="../unsupervised_models/">Unsupervised models</a></li><li><a class="tocitem" href="../static_models/">Static models</a></li><li><a class="tocitem" href="../outlier_detection_models/">Outlier detection models</a></li><li><a class="tocitem" href="../convenience_methods/">Convenience methods</a></li><li><a class="tocitem" href="../where_to_put_code/">Where to place code implementing new models</a></li><li><a class="tocitem" href="../how_to_register/">How to add models to the MLJ Model Registry</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>New model type declarations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>New model type declarations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaAI/MLJModelInterface.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaAI/MLJModelInterface.jl/blob/dev/docs/src/type_declarations.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="New-model-type-declarations"><a class="docs-heading-anchor" href="#New-model-type-declarations">New model type declarations</a><a id="New-model-type-declarations-1"></a><a class="docs-heading-anchor-permalink" href="#New-model-type-declarations" title="Permalink"></a></h1><p>Here is an example of a concrete supervised model type declaration, for a model with a single hyperparameter:</p><pre><code class="language-julia hljs">import MLJModelInterface
const MMI = MLJModelInterface

mutable struct RidgeRegressor &lt;: MMI.Deterministic
	lambda::Float64
end</code></pre><p>Models (which are mutable) should not be given internal constructors. It is recommended that they be given an external lazy keyword constructor of the same name. This constructor defines default values for every field, and optionally corrects invalid field values by calling a <code>clean!</code> method (whose fallback returns an empty message string):</p><pre><code class="language-julia hljs">function MMI.clean!(model::RidgeRegressor)
	warning = &quot;&quot;
	if model.lambda &lt; 0
		warning *= &quot;Need lambda ≥ 0. Resetting lambda=0. &quot;
		model.lambda = 0
	end
	return warning
end

# keyword constructor
function RidgeRegressor(; lambda=0.0)
	model = RidgeRegressor(lambda)
	message = MMI.clean!(model)
	isempty(message) || @warn message
	return model
end</code></pre><p><em>Important.</em> Performing <code>clean!(model)</code> a second time should not mutate <code>model</code>. That is, this test should hold:</p><pre><code class="language-julia hljs">clean!(model)
clone = deepcopy(model)
clean!(model)
@test model == clone</code></pre><p>Although not essential, try to avoid <code>Union</code> types for model fields. For example, a field declaration <code>features::Vector{Symbol}</code> with a default of <code>Symbol[]</code> (detected with <code>isempty</code> method) is preferred to <code>features::Union{Vector{Symbol}, Nothing}</code> with a default of <code>nothing</code>.</p><h3 id="Hyperparameters-for-parallelization-options"><a class="docs-heading-anchor" href="#Hyperparameters-for-parallelization-options">Hyperparameters for parallelization options</a><a id="Hyperparameters-for-parallelization-options-1"></a><a class="docs-heading-anchor-permalink" href="#Hyperparameters-for-parallelization-options" title="Permalink"></a></h3><p>The section <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/acceleration_and_parallelism/">Acceleration and Parallelism</a> of the MLJ manual indicates how users specify an option to run an algorithm using distributed processing or multithreading. A hyperparameter specifying such an option should be called <code>acceleration</code>. Its value <code>a</code> should satisfy <code>a isa AbstractResource</code> where <code>AbstractResource</code> is defined in the ComputationalResources.jl package. An option to run on a GPU is ordinarily indicated with the <code>CUDALibs()</code> resource.</p><h3 id="hyperparameter-access-and-mutation"><a class="docs-heading-anchor" href="#hyperparameter-access-and-mutation">hyperparameter access and mutation</a><a id="hyperparameter-access-and-mutation-1"></a><a class="docs-heading-anchor-permalink" href="#hyperparameter-access-and-mutation" title="Permalink"></a></h3><p>To support hyperparameter optimization (see the <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/tuning_models/">Tuning Models</a> section of the MLJ manual) any hyperparameter to be individually controlled must be:</p><ul><li><p>property-accessible; nested property access allowed, as in <code>model.detector.K</code></p></li><li><p>mutable</p></li></ul><p>For an un-nested hyperparameter, the requirement is that <code>getproperty(model, :param_name)</code> and <code>setproperty!(model, :param_name, value)</code> have the expected behavior.</p><p>Combining hyperparameters in a named tuple does not generally work: although property-accessible (with nesting), an individual value cannot be mutated.</p><p>For a suggested way to deal with hyperparameters varying in number, see the <a href="https://github.com/JuliaAI/MLJBase.jl/blob/dev/src/composition/models/stacking.jl">implementation</a> of <code>Stack</code>, where the model struct stores a varying number of base models internally as a vector, but components are named at construction and accessed by overloading <code>getproperty/setproperty!</code>  appropriately.</p><h3 id="Macro-shortcut"><a class="docs-heading-anchor" href="#Macro-shortcut">Macro shortcut</a><a id="Macro-shortcut-1"></a><a class="docs-heading-anchor-permalink" href="#Macro-shortcut" title="Permalink"></a></h3><p>An alternative to declaring the model struct, clean! method and keyword constructor, is to use the <code>@mlj_model</code> macro, as in the following example:</p><pre><code class="language-julia hljs">@mlj_model mutable struct YourModel &lt;: MMI.Deterministic
	a::Float64 = 0.5::(_ &gt; 0)
	b::String  = &quot;svd&quot;::(_ in (&quot;svd&quot;,&quot;qr&quot;))
end</code></pre><p>This declaration specifies:</p><ul><li>A keyword constructor (here <code>YourModel(; a=..., b=...)</code>),</li><li>Default values for the hyperparameters,</li><li>Constraints on the hyperparameters where <code>_</code> refers to a value passed.</li></ul><p>For example, <code>a::Float64 = 0.5::(_ &gt; 0)</code> indicates that the field <code>a</code> is a <code>Float64</code>, takes <code>0.5</code> as default value, and expects its value to be positive.</p><p>You cannot use the <code>@mlj_model</code> macro if your model struct has type parameters.</p><h4 id="Known-issue-with-@mlj_macro"><a class="docs-heading-anchor" href="#Known-issue-with-@mlj_macro">Known issue with @mlj_macro</a><a id="Known-issue-with-@mlj_macro-1"></a><a class="docs-heading-anchor-permalink" href="#Known-issue-with-@mlj_macro" title="Permalink"></a></h4><p>Defaults with negative values can trip up the <code>@mlj_macro</code> (see <a href="https://github.com/JuliaAI/MLJBase.jl/issues/68">this issue</a>). So, for example, this does not work:</p><pre><code class="language-julia hljs">@mlj_model mutable struct Bar
	a::Int = -1::(_ &gt; -2)
end</code></pre><p>But this does:</p><pre><code class="language-julia hljs">@mlj_model mutable struct Bar
	a::Int = (-)(1)::(_ &gt; -2)
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../the_model_type_hierarchy/">« The model type hierarchy</a><a class="docs-footer-nextpage" href="../supervised_models/">Supervised models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Friday 23 February 2024 04:22">Friday 23 February 2024</span>. Using Julia version 1.10.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
